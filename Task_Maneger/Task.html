<!doctype html>
<html lang="ja">
<head>
Â  <link rel="icon" href="../keep_out/Game_Developing.png" type="image/x-icon">
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  <title>ã‚½ãƒ¼ãƒˆä»˜ãTODO</title>
Â  <style>
Â  Â  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans JP',sans-serif;margin:24px;background:#f7f8fb}
Â  Â  .wrap{max-width:720px;margin:0 auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 6px 20px rgba(30,30,60,0.06)}
Â  Â  h1{margin:0 0 12px;font-size:20px}
Â  Â  h2{margin:24px 0 12px;font-size:18px;border-bottom:2px solid #eee;padding-bottom:4px;}
Â  Â  .input-row{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
Â  Â  input[type=text],input[type=datetime-local]{flex:1;padding:10px;border:1px solid #ddd;border-radius:8px}
Â  Â  button{padding:8px 12px;border-radius:8px;border:0;background:#2563eb;color:#fff;cursor:pointer}
Â  Â  ul{list-style:none;padding:0;margin:0}
Â  Â  li{display:flex;align-items:center;gap:8px;padding:8px;border-bottom:1px solid #f0f2f6;flex-wrap:wrap}
Â  Â  li .txt{flex:1}
Â  Â  .small{font-size:12px;color:#666}
Â  Â  .controls{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
Â  Â  .muted{background:#eee;color:#333}
Â  Â  .date-label{font-size:12px;color:#888;margin-left:8px;}
Â  Â  .guide {background:#f0f4ff;border-left:4px solid #2563eb;padding:10px 14px;margin-bottom:16px;border-radius:6px;font-size:14px;line-height:1.6;}
Â  Â  #bulk-controls-main, #bulk-controls-asap{display:flex;gap:8px;align-items:center;margin-bottom:8px;}
Â  Â  /* ASAPã‚¾ãƒ¼ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¼·èª¿ */
Â  Â  .asap-task {background-color: #fff9e6;}
Â  Â  .asap-input {border-color: #ffc107;}
Â  </style>
</head>

<body>
Â  <div class="wrap">
Â  Â  <h1>ã‚½ãƒ¼ãƒˆä»˜ãTODO</h1>

Â  Â  Â  Â  <div class="guide">
Â  Â  Â  <strong>ä½¿ã„æ–¹ï¼š</strong>
Â  Â  Â  <ul style="margin:6px 0 0 16px;">
Â  Â  Â  Â  <li><b>ASAPã‚¾ãƒ¼ãƒ³ï¼š</b> æœ€å„ªå…ˆã‚¿ã‚¹ã‚¯ã€‚ç· åˆ‡ã¯è¨­å®šã§ãã¾ã›ã‚“ã€‚</li>
Â  Â  Â  Â  <li><b>ãƒ¡ã‚¤ãƒ³ãƒªã‚¹ãƒˆï¼š</b> é€šå¸¸ã®ã‚¿ã‚¹ã‚¯ã€‚ç· åˆ‡æ—¥æ™‚ã‚’è¨­å®šå¯èƒ½ã€‚</li>
Â  Â  Â  Â  <li>ã‚¿ã‚¹ã‚¯ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã«è‡ªå‹•ä¿å­˜ã•ã‚Œã¾ã™ã€‚</li>
Â  Â  Â  </ul>
Â  Â  </div>

Â  Â  Â  Â  <h2>ğŸ”¥ ASAPã‚¾ãƒ¼ãƒ³</h2>
Â  Â  Â  Â  <div class="input-row">
Â  Â  Â  <input id="asap-input" type="text" placeholder="ASAPã§ã‚„ã‚‹ã“ã¨ã‚’å…¥åŠ›" class="asap-input" />
Â  Â  Â  Â  Â  Â  <button id="add-asap-btn">è¿½åŠ </button>
Â  Â  </div>
Â  Â  Â  Â  <div id="bulk-controls-asap">
Â  Â  Â  <input type="checkbox" id="select-all-asap"> <label for="select-all-asap">å…¨é¸æŠ</label>
Â  Â  Â  <button id="delete-selected-asap" class="muted">âœ” ASAPã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤</button>
Â  Â  </div>
Â  Â  Â  Â  <ul id="list-asap"></ul>


Â  Â  Â  Â  <h2>âœ… ãƒ¡ã‚¤ãƒ³ãƒªã‚¹ãƒˆ</h2>
Â  Â  Â  Â  <div class="input-row">
Â  Â  Â  <input id="todo-input" type="text" placeholder="ã‚„ã‚‹ã“ã¨ã‚’å…¥åŠ›" />
Â  Â  Â  <input id="todo-date" type="datetime-local" style="max-width:180px;" />
Â  Â  Â  <button id="add-btn">è¿½åŠ </button>
Â  Â  </div>
Â  Â  Â  Â  <div id="bulk-controls-main">
Â  Â  Â  <input type="checkbox" id="select-all-main"> <label for="select-all-main">å…¨é¸æŠ</label>
Â  Â  Â  <button id="delete-selected-main" class="muted">âœ” ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤</button>
Â  Â  </div>
Â  Â  Â  Â  <ul id="list-main"></ul>

Â  Â  <hr>

Â  Â  Â  Â  <div class="controls">
Â  Â  Â  <button id="export-btn" class="muted">JSONã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
Â  Â  Â  <button id="import-btn" class="muted">JSONã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
Â  Â  Â  <button id="save-fsa" class="muted">ç›´æ¥ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ï¼ˆFile System Accessï¼‰</button>
Â  Â  Â  <input id="file-input" type="file" accept="application/json" style="display:none" />
Â  Â  </div>

Â  Â  <p class="small">
Â  Â  Â  è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼šãƒ–ãƒ©ã‚¦ã‚¶ã® <code>localStorage</code> ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚
Â  Â  </p>
Â  </div>

Â  <script>
Â  Â  const STORAGE_KEY='local_todo_asap_v1';
Â  Â  let todos=[];
Â  Â  let asapTodos=[];

Â  Â  const input=document.getElementById('todo-input');
Â  Â  const dateInput=document.getElementById('todo-date');
Â  Â  const addBtn=document.getElementById('add-btn');
Â  Â  const listMainEl=document.getElementById('list-main');

Â  Â  const asapInput=document.getElementById('asap-input');
Â  Â  const addAsapBtn=document.getElementById('add-asap-btn');
Â  Â  const listAsapEl=document.getElementById('list-asap');

Â  Â  const selectAllMain=document.getElementById('select-all-main');
Â  Â  const deleteSelectedMain=document.getElementById('delete-selected-main');
Â  Â  const selectAllAsap=document.getElementById('select-all-asap');
Â  Â  const deleteSelectedAsap=document.getElementById('delete-selected-asap');

Â  Â  const exportBtn=document.getElementById('export-btn');
Â  Â  const importBtn=document.getElementById('import-btn');
Â  Â  const fileInput=document.getElementById('file-input');
Â  Â  const saveFsaBtn=document.getElementById('save-fsa');
Â  Â  let fileHandle=null;

Â  Â  function saveToLocalStorage(){
Â  Â  Â  localStorage.setItem(STORAGE_KEY,JSON.stringify({todos,asapTodos}));
Â  Â  }

Â  Â  function loadFromLocalStorage(){
Â  Â  Â  const raw=localStorage.getItem(STORAGE_KEY);
Â  Â  Â  if(!raw)return;
Â  Â  Â  try{
Â  Â  Â  Â  const data=JSON.parse(raw);
Â  Â  Â  Â  if(Array.isArray(data.todos)) todos=data.todos;
Â  Â  Â  Â  if(Array.isArray(data.asapTodos)) asapTodos=data.asapTodos;
Â  Â  Â  }catch{
Â  Â  Â  Â  todos=[]; asapTodos=[];
Â  Â  Â  }
Â  Â  }

Â  Â  // ã‚¿ã‚¹ã‚¯æç”»ã®å…±é€šé–¢æ•°
Â  Â  function createTaskElement(t, index, listType){
Â  Â  Â  const li=document.createElement('li');
Â  Â  Â  if(listType === 'asap') li.classList.add('asap-task');

Â  Â  Â  const chkMain=document.createElement('input');
Â  Â  Â  chkMain.type='checkbox';chkMain.className=`select-task-${listType}`;chkMain.dataset.index=index;

Â  Â  Â  const done=document.createElement('input');
Â  Â  Â  done.type='checkbox';done.checked=!!t.done;
Â  Â  Â  done.addEventListener('change',()=>{
Â  Â  Â  Â  const list = listType === 'main' ? todos : asapTodos;
Â  Â  Â  Â  list[index].done=done.checked;
Â  Â  Â  Â  saveToLocalStorage();
Â  Â  Â  Â  render();
Â  Â  Â  });

Â  Â  Â  const span=document.createElement('span');
Â  Â  Â  span.className='txt';span.textContent=t.text;
Â  Â  Â  if(t.done) span.style.textDecoration='line-through';

Â  Â  Â  if(listType === 'main' && t.date){ // ASAPã‚¾ãƒ¼ãƒ³ã§ã¯æ—¥ä»˜ã‚’è¡¨ç¤ºã—ãªã„
Â  Â  Â  Â  const dateLabel=document.createElement('span');
Â  Â  Â  Â  dateLabel.className='date-label';
Â  Â  Â  Â  // ğŸ“… æ—¥ä»˜ã‚’ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ã§è¡¨ç¤ºï¼†æ›œæ—¥ã‚’è¿½åŠ 
Â  Â  Â  Â  const d = new Date(t.date);
Â  Â  Â  Â  const weekdays = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];
Â  Â  Â  Â  const wd = weekdays[d.getDay()];
Â  Â  Â  Â  const y = d.getFullYear();
Â  Â  Â  Â  const m = d.getMonth() + 1;
Â  Â  Â  Â  const day = d.getDate();
Â  Â  Â  Â  const hh = String(d.getHours()).padStart(2, '0');
Â  Â  Â  Â  const mm = String(d.getMinutes()).padStart(2, '0');
Â  Â  Â  Â  dateLabel.textContent = `æœŸé™:${y}/${m}/${day}(${wd}) ${hh}:${mm}`;
Â  Â  Â  Â  li.appendChild(dateLabel);
Â  Â  Â  }

Â  Â  Â  const edit=document.createElement('button');
Â  Â  Â  edit.textContent='ç·¨é›†';edit.className='muted';
Â  Â  Â  edit.addEventListener('click',()=>{
Â  Â  Â  Â  const list = listType === 'main' ? todos : asapTodos;
Â  Â  Â  Â  const v=prompt('ç·¨é›†ã—ã¦ãã ã•ã„',t.text);
Â  Â  Â  Â  if(v!==null){list[index].text=v.trim();saveToLocalStorage();render();}
Â  Â  Â  });

Â  Â  Â  const del=document.createElement('button');
Â  Â  Â  del.textContent='å‰Šé™¤';del.className='muted';
Â  Â  Â  del.addEventListener('click',()=>{
Â  Â  Â  Â  if(confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')){
Â  Â  Â  Â  Â  const list = listType === 'main' ? todos : asapTodos;
Â  Â  Â  Â  Â  list.splice(index,1);
Â  Â  Â  Â  Â  saveToLocalStorage();render();
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  Â  
Â  Â  Â  li.prepend(chkMain,done,span);
Â  Â  Â  li.append(edit,del);
Â  Â  Â  return li;
Â  Â  }

Â  Â  function render(){
Â  Â  Â  // ãƒ¡ã‚¤ãƒ³ãƒªã‚¹ãƒˆã®æç”»
Â  Â  Â  listMainEl.innerHTML='';
Â  Â  Â  // ç· åˆ‡æ—¥ã§ã‚½ãƒ¼ãƒˆï¼ˆãƒ¡ã‚¤ãƒ³ãƒªã‚¹ãƒˆï¼‰
Â  Â  Â  todos.sort((a,b)=>{
Â  Â  Â  Â  // dateãŒãªã„ã‚‚ã®ã¯æœ€å¾Œã«
Â  Â  Â  Â  if(!a.date && !b.date) return (a.createdAt || '').localeCompare(b.createdAt || '');
Â  Â  Â  Â  if(!a.date) return 1;
Â  Â  Â  Â  if(!b.date) return -1;
Â  Â  Â  Â  return a.date.localeCompare(b.date);
Â  Â  Â  });
Â  Â  Â  todos.forEach((t,i)=>{
Â  Â  Â  Â  listMainEl.appendChild(createTaskElement(t,i,'main'));
Â  Â  Â  });

Â  Â  Â  // ASAPãƒªã‚¹ãƒˆã®æç”»
Â  Â  Â  listAsapEl.innerHTML='';
Â  Â  Â  // ä½œæˆæ—¥ã§ã‚½ãƒ¼ãƒˆï¼ˆASAPãƒªã‚¹ãƒˆï¼‰
Â  Â  Â  asapTodos.sort((a,b)=>(a.createdAt||'').localeCompare(b.createdAt||''));
Â  Â  Â  asapTodos.forEach((t,i)=>{
Â  Â  Â  Â  listAsapEl.appendChild(createTaskElement(t,i,'asap'));
Â  Â  Â  });
Â  Â  }

Â  Â  // dateå¼•æ•°ã¯ãƒ¡ã‚¤ãƒ³ãƒªã‚¹ãƒˆç”¨ã€‚ASAPãƒªã‚¹ãƒˆã®å ´åˆã¯nullã‚’æ¸¡ã™
Â  Â  function addTodo(text,date,listType){
Â  Â  Â  text=text.trim();if(!text)return;
Â  Â  Â  const newList = {
Â  Â  Â  Â  text,done:false,createdAt:new Date().toISOString(),
Â  Â  Â  Â  date:date||null
Â  Â  Â  };
Â  Â  Â  
Â  Â  Â  if(listType === 'main'){
Â  Â  Â  Â  todos.push(newList);
Â  Â  Â  } else {
Â  Â  Â  Â  asapTodos.push(newList);
Â  Â  Â  }

Â  Â  Â  saveToLocalStorage();
Â  Â  Â  render();
Â  Â  }

Â  Â  // ãƒ¡ã‚¤ãƒ³ãƒªã‚¹ãƒˆã®è¿½åŠ 
Â  Â  addBtn.addEventListener('click',()=>{
Â  Â  Â  addTodo(input.value,dateInput.value,'main');
Â  Â  Â  input.value='';dateInput.value='';
Â  Â  });

Â  Â  // ASAPãƒªã‚¹ãƒˆã®è¿½åŠ 
Â  Â  addAsapBtn.addEventListener('click',()=>{
Â  Â  Â  addTodo(asapInput.value,null,'asap'); // dateã«ã¯nullã‚’æ¸¡ã™
Â  Â  Â  asapInput.value='';
Â  Â  });


Â  Â  // âœ… ä¸€æ‹¬å‰Šé™¤æ©Ÿèƒ½ (ãƒ¡ã‚¤ãƒ³)
Â  Â  selectAllMain.addEventListener('change',()=>{
Â  Â  Â  const checks=[...document.querySelectorAll('.select-task-main')];
Â  Â  Â  checks.forEach(c=>c.checked=selectAllMain.checked);
Â  Â  });

Â  Â  deleteSelectedMain.addEventListener('click',()=>{
Â  Â  Â  const checks=[...document.querySelectorAll('.select-task-main:checked')];
Â  Â  Â  if(checks.length===0)return alert('å‰Šé™¤ã™ã‚‹ã‚¿ã‚¹ã‚¯ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚');
Â  Â  Â  if(!confirm(`${checks.length}ä»¶ã®ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`))return;
Â  Â  Â  const indices=checks.map(c=>Number(c.dataset.index)).sort((a,b)=>b-a);
Â  Â  Â  indices.forEach(i=>todos.splice(i,1));
Â  Â  Â  saveToLocalStorage();render();
Â  Â  });

Â  Â  // âœ… ä¸€æ‹¬å‰Šé™¤æ©Ÿèƒ½ (ASAP)
Â  Â  selectAllAsap.addEventListener('change',()=>{
Â  Â  Â  const checks=[...document.querySelectorAll('.select-task-asap')];
Â  Â  Â  checks.forEach(c=>c.checked=selectAllAsap.checked);
Â  Â  });

Â  Â  deleteSelectedAsap.addEventListener('click',()=>{
Â  Â  Â  const checks=[...document.querySelectorAll('.select-task-asap:checked')];
Â  Â  Â  if(checks.length===0)return alert('å‰Šé™¤ã™ã‚‹ASAPã‚¿ã‚¹ã‚¯ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚');
Â  Â  Â  if(!confirm(`${checks.length}ä»¶ã®ASAPã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`))return;
Â  Â  Â  const indices=checks.map(c=>Number(c.dataset.index)).sort((a,b)=>b-a);
Â  Â  Â  indices.forEach(i=>asapTodos.splice(i,1));
Â  Â  Â  saveToLocalStorage();render();
Â  Â  });

Â  Â  // ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ (ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/ã‚¤ãƒ³ãƒãƒ¼ãƒˆ/FSA)
Â  Â  exportBtn.addEventListener('click',()=>{
Â  Â  Â  const allData = {todos, asapTodos};
Â  Â  Â  if(allData.todos.length===0 && allData.asapTodos.length===0) return alert('ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
Â  Â  Â  const blob=new Blob([JSON.stringify(allData,null,2)],{type:'application/json'});
Â  Â  Â  const url=URL.createObjectURL(blob);
Â  Â  Â  const a=document.createElement('a');a.href=url;a.download='todos_asap.json';a.click();
Â  Â  Â  URL.revokeObjectURL(url);
Â  Â  });

Â  Â  importBtn.addEventListener('click',()=>fileInput.click());
Â  Â  fileInput.addEventListener('change',async ev=>{
Â  Â  Â  const f=ev.target.files[0];if(!f)return;
Â  Â  Â  try{
Â  Â  Â  Â  const txt=await f.text();
Â  Â  Â  Â  const parsed=JSON.parse(txt);
Â  Â  Â  Â  if(typeof parsed !== 'object' || parsed === null || (!Array.isArray(parsed.todos) && !Array.isArray(parsed.asapTodos))) throw new Error('ãƒ‡ãƒ¼ã‚¿å½¢å¼ãŒä¸æ­£ã§ã™');
Â  Â  Â  Â  
Â  Â  Â  Â  if(confirm('è¿½åŠ ã—ã¾ã™ã‹ï¼Ÿã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§ä¸Šæ›¸ãã—ã¾ã™ã€‚')){
Â  Â  Â  Â  Â  if(Array.isArray(parsed.todos)) todos=todos.concat(parsed.todos);
Â  Â  Â  Â  Â  if(Array.isArray(parsed.asapTodos)) asapTodos=asapTodos.concat(parsed.asapTodos);
Â  Â  Â  Â  }else{
Â  Â  Â  Â  Â  if(Array.isArray(parsed.todos)) todos=parsed.todos;
Â  Â  Â  Â  Â  if(Array.isArray(parsed.asapTodos)) asapTodos=parsed.asapTodos;
Â  Â  Â  Â  Â  else {todos=[]; asapTodos=[];}
Â  Â  Â  Â  }
Â  Â  Â  Â  saveToLocalStorage();render();
Â  Â  Â  }catch(err){alert('èª­ã¿è¾¼ã¿å¤±æ•—:'+err.message);}
Â  Â  Â  fileInput.value='';
Â  Â  });

Â  Â  saveFsaBtn.addEventListener('click',async()=>{
Â  Â  Â  if(!('showSaveFilePicker'in window)){alert('ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éå¯¾å¿œ');return;}
Â  Â  Â  try{
Â  Â  Â  Â  if(!fileHandle){
Â  Â  Â  Â  Â  fileHandle=await window.showSaveFilePicker({suggestedName:'todos_asap.json',types:[{description:'JSON',accept:{'application/json':['.json']}}]});
Â  Â  Â  Â  }
Â  Â  Â  Â  const writable=await fileHandle.createWritable();
Â  Â  Â  Â  await writable.write(JSON.stringify({todos, asapTodos},null,2));
Â  Â  Â  Â  await writable.close();alert('ä¿å­˜ã—ã¾ã—ãŸ');
Â  Â  Â  }catch(e){if(e.name!=='AbortError')console.error(e);}
Â  Â  });

Â  Â  loadFromLocalStorage();render();
Â  </script>
</body>
<!--
ä»Šå¾Œã®è¿½åŠ è¦ç´ 
-Enterã§è¿½åŠ 
-æœŸé™åˆ‡ã‚Œã®ã‚¿ã‚¹ã‚¯ã‚’è¡¨ç¤º
-ãƒ‡ã‚¶ã‚¤ãƒ³å¤‰æ›´
-ç·¨é›†æ©Ÿèƒ½ã§æ—¥ä»˜ã‚‚å¤‰æ›´ã§ãã‚‹ã‚ˆã†ã«
-èª²é¡Œã®è©³ç´°ã‚’æ›¸ãè¾¼ã‚ã‚‹ã‚ˆã†ã«
    -->
</html>

